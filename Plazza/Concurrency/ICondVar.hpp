///////////////////////////////////////////////////////////////////////////////
// Header guard
///////////////////////////////////////////////////////////////////////////////
#pragma once

///////////////////////////////////////////////////////////////////////////////
// Dependencies
///////////////////////////////////////////////////////////////////////////////
#include "Concurrency/IMutex.hpp"
#include <chrono>

///////////////////////////////////////////////////////////////////////////////
// Namespace Plazza
///////////////////////////////////////////////////////////////////////////////
namespace Plazza
{

///////////////////////////////////////////////////////////////////////////////
/// \brief
///
///////////////////////////////////////////////////////////////////////////////
class ICondVar
{
public:
    ///////////////////////////////////////////////////////////////////////////
    /// \brief
    ///
    ///////////////////////////////////////////////////////////////////////////
    virtual ~ICondVar() = default;

public:
    ///////////////////////////////////////////////////////////////////////////
    /// \brief
    ///
    /// \param mutex
    ///
    /// \return
    ///
    ///////////////////////////////////////////////////////////////////////////
    virtual void Wait(IMutex& mutex) = 0;

    ///////////////////////////////////////////////////////////////////////////
    /// \brief
    ///
    /// \param mutex
    /// \param relTime
    ///
    ///////////////////////////////////////////////////////////////////////////
    template <class Rep, class Period>
    bool WaitFor(
        IMutex& mutex,
        const std::chrono::duration<Rep, Period>& relTime
    );

    ///////////////////////////////////////////////////////////////////////////
    /// \brief
    ///
    /// \param lock
    /// \param timeout
    ///
    ///////////////////////////////////////////////////////////////////////////
    template<typename Rep, typename Period>
    bool WaitFor(
        std::unique_lock<std::mutex>& lock, 
        const std::chrono::duration<Rep, Period>& timeout
    );

    ///////////////////////////////////////////////////////////////////////////
    /// \brief
    ///
    ///////////////////////////////////////////////////////////////////////////
    virtual void NotifyOne(void) = 0;

    ///////////////////////////////////////////////////////////////////////////
    /// \brief
    ///
    ///////////////////////////////////////////////////////////////////////////
    virtual void NotifyAll(void) = 0;

protected:
    ///////////////////////////////////////////////////////////////////////////
    /// \brief
    ///
    /// \param mutex
    /// \param relTime
    ///
    ///////////////////////////////////////////////////////////////////////////
    virtual bool DoWaitFor(
        IMutex& mutex,
        const std::chrono::milliseconds& relTime
    ) = 0;

    ///////////////////////////////////////////////////////////////////////////
    /// \brief
    ///
    /// \param lock
    /// \param timeout
    ///
    ///////////////////////////////////////////////////////////////////////////
    virtual bool DoWaitFor(
        std::unique_lock<std::mutex>& lock,
        const std::chrono::milliseconds& timeout
    ) = 0;
};

} // !namespace Plazza

///////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////
#include "Concurrency/ICondVar.inl"
